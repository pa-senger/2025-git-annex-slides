%--------------------------------------
% Create title frame
\titleframe

%--------------------------------------
% Table of contents
\begin{frame}{Overview}
  \setbeamertemplate{section in toc}[sections numbered]
  \tableofcontents[hideallsubsections]
\end{frame}

%--------------------------------------
\section{Context}

\begin{frame}{Context}
  \begin{itemize}
    \item \textbf{HPC} often requires large datasets
    \item \textbf{Git} is not designed for large files
  \end{itemize}
\end{frame}

\section{Possible solutions}
\begin{frame}{Keep the data locally}
  Works but not ideal, especially for:
  \begin{itemize}
    \item \textbf{Collaboration} (multiple users)
    \item \textbf{Reproducibility} (multiple runs)
    \item \textbf{Continuous integration} (CI)
    \item \textbf{Versioning} (multiple versions)
    \item \textbf{Backup} (multiple copies)
  \end{itemize}
\end{frame}

\begin{frame}{Avoidance}
  \begin{itemize}
    \item \textbf{File generation} on demand or at execution time
    \item \textbf{Data reduction:} e.g. only store the most meaningful data
    \item \textbf{User specifies} which statistics/visualization to generate at each execution
    \item \textit{etc.}
  \end{itemize}
\end{frame}

\begin{frame}{Cloud storage}
  Everyday user (e.g. Google Drive, Dropbox, OneDrive, etc.) \\
  Targeted at scientific collaboration (e.g. Zenodo, Figshare, Dryad, OSF, etc.)\\
  Problematics:
  \begin{itemize}
    \item \textbf{Requires lots of scripting} to integrate in the HPC workflow
    \item \textbf{Requires special security measures} to protect sensitive data
    \item \textbf{How to detect and manage errors?}
    \item \textbf{Compatibility issues}
  \end{itemize}
\end{frame}

\begin{frame}{Git LFS}
  Open source extension to Git
  \begin{itemize}
    \item Replaces large files with text pointers inside Git, while storing the file contents on a remote server
    \item No need for custom scripting
    \item \textbf{Consistent} between local and remote
  \end{itemize}
  Suboptimal usage of local storage:
  \begin{itemize}
    \item \textbf{Uses locally twice the space} (files are duplicated in \texttt{.git/lfs})
    \item \textbf{Large files} are automatically downloaded when cloning a repo
    \item End users have nearly \textbf{no permission} on the remote server
  \end{itemize}
\end{frame}

\begin{frame}{Git-annex}
  Open source extension to Git
  \begin{itemize}
    \item Allows managing large files with Git without checking the file contents into Git
    \item Uses \textbf{symlinks} to optimize local storage
    \item \textbf{No duplication} of files
    \item No intrinsic limit on file size or bandwidth
  \end{itemize}
  More controls for the user:
  \begin{itemize}
    \item Can decide at anytime which files to keep locally
    \item Can use special command to download or drop files
  \end{itemize}
\end{frame}

\begin{frame}{Git-annex}
    Supports the download of large files content from either:
  \begin{itemize}
    \item Some other git-annex repository on another machine (provided there is a ssh connection possible)
    \item A cloud storage provider (e.g. Amazon S3, Google Drive, Dropbox, etc.)
  \end{itemize}
  Main drawback:
  \begin{itemize}
    \item \textbf{Non natively supported} by GitHub, GitLab, etc. (files needs to be managed with commandlines)
    \item \textbf{Learning curve}
    \item \textbf{Not as common} as Git LFS, support may be harder to find
  \end{itemize}
\end{frame}

% --------------------------------------
\section{Installation and Usage}

\begin{frame}[fragile]{Installation and Usage}
  \begin{itemize}
    \item \texttt{sudo apt-get install git-annex} (Debian/Ubuntu)
    \item \texttt{sudo pacman -Syu git-annex} (Arch)
    \item \texttt{brew install git-annex} (MacOS)
  \end{itemize}

  Initialize and add a large file (single quotes are important):
  \begin{lstlisting}[language=bash]
  git annex init 'PA laptop'
  git annex addurl --file=large_file.zip download_url_link
  git commit -m "Add large_file.zip"
  git push origin main git-annex
  git annex list
  git annex whereis large_file.zip
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]{Usage}
  Retrieve a file from another repository:
  \begin{lstlisting}[language=bash]
    git annex init 'Alice laptop'
    git annex get .
    \end{lstlisting}
  Annexing a new version:
    \begin{lstlisting}[language=bash]
      git annex drop large_file.zip
      git rm large_file.zip
      git annex addurl --file=large_file.zip download_url_link
      git commit -m "Update large_file.zip"
      git annex sync
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile]{Usage}
  Retrieve the newer version:
  \begin{lstlisting}[language=bash]
    git annex sync
    git annex get .
  \end{lstlisting}
\end{frame}

\begin{frame}{The end}
  \Large
  \centering
  \textbf{Thank you for your attention!} \\
  \vspace{1em}
  \includegraphics[height=1cm]{party-emoji.png} \\
  \vspace{1em}
  \textbf{Any questions?} \\
  \vspace{2em}
  \small
  \textit{Contact Information:} \\
  pierre.antoine.senger@gmail.com \\
  github.com/PA-Senger
\end{frame}

\printbibliography
